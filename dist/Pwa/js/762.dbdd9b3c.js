"use strict";(self["webpackChunknaxchatappv3"]=self["webpackChunknaxchatappv3"]||[]).push([[762],{141:(e,t,a)=>{a.d(t,{Z:()=>r});a(979),a(6105),a(2396),a(6101),a(71),a(7965),a(6016);let o="undefined"!==typeof Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),s=o&&"undefined"!==typeof Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),i="undefined"!==typeof HTMLCanvasElement&&HTMLCanvasElement.prototype.toBlob,n=i||"undefined"!==typeof Uint8Array&&"undefined"!==typeof ArrayBuffer&&"undefined"!==typeof atob,l="undefined"!==typeof FileReader||"undefined"!==typeof URL;class r{static resize(e,t,a){"function"===typeof t&&(a=t,t={width:640,height:480});t.width,t.height;if(!r.isSupported()||!e.type.match(/image.*/))return a(e,!1),!1;if(e.type.match(/image\/gif/))return a(e,!1),!1;let o=document.createElement("img");return o.onload=s=>{let n=o.width,l=o.height,c=!1;if(n>=l&&n>t.width?(l*=t.width/n,n=t.width,c=!0):l>t.height&&(n*=t.height/l,l=t.height,c=!0),!c)return void a(e,!1);let d=document.createElement("canvas");d.width=n,d.height=l;let u=d.getContext("2d");if(u.drawImage(o,0,0,n,l),i)d.toBlob((e=>{a(e,!0)}),e.type);else{let t=r._toBlob(d,e.type);a(t,!0)}},r._loadImage(o,e),!0}static _toBlob(e,t){let a,i=e.toDataURL(t),n=i.split(",");a=n[0].indexOf("base64")>=0?atob(n[1]):decodeURIComponent(n[1]);let l=new ArrayBuffer(a.length),r=new Uint8Array(l);for(let o=0;o<a.length;o+=1)r[o]=a.charCodeAt(o);let c=n[0].split(":")[1].split(";")[0],d=null;if(o)d=new Blob([s?r:l],{type:c});else{let e=new BlobBuilder;e.append(l),d=e.getBlob(c)}return d}static _loadImage(e,t,a){if("undefined"===typeof URL){let o=new FileReader;o.onload=function(t){e.src=t.target.result,a&&a()},o.readAsDataURL(t)}else e.src=URL.createObjectURL(t),a&&a()}static isSupported(){return"undefined"!==typeof HTMLCanvasElement&&n&&l}}},9390:(e,t,a)=>{a.d(t,{Z:()=>b});var o=a(3673),s=a(2323);const i={class:"chats"},n={key:0},l=["href"],r={key:3},c=["src"],d=(0,o._)("br",null,null,-1),u={class:"text-caption text-bold"};function h(e,t,a,h,g,m){const p=(0,o.up)("q-img"),f=(0,o.up)("fotoCanvas"),w=(0,o.up)("q-dialog");return(0,o.wg)(),(0,o.iD)("span",i,["text"===a.message.tipo?((0,o.wg)(),(0,o.iD)("span",n,(0,s.zw)(a.message.text),1)):"foto"===a.message.tipo?((0,o.wg)(),(0,o.j4)(p,{key:1,style:{width:"180px",height:"180px"},src:a.message.text,onClick:t[0]||(t[0]=e=>(m.foto(a.message.text),g.watch=!0)),loading:"lazy"},null,8,["src"])):"url"===a.message.tipo?((0,o.wg)(),(0,o.iD)("a",{key:2,href:a.message.text,target:"_blank",style:{"text-decoration":"none",color:"black",background:"white",width:"100%","border-radius":"25px","text-align":"center",display:"inline-block"}}," Archivo ",8,l)):"gif"===a.message.tipo?((0,o.wg)(),(0,o.iD)("div",r,[(0,o._)("iframe",{frameborder:"0",style:{width:"180px",height:"180px","pointer-events":"none"},src:a.message.text,loading:"lazy"},null,8,c)])):(0,o.kq)("",!0),d,(0,o._)("span",u,(0,s.zw)(a.message.hora),1),(0,o.Wm)(w,{modelValue:g.watch,"onUpdate:modelValue":t[1]||(t[1]=e=>g.watch=e),maximized:g.maximized},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{fotoClick:g.fotoClick},null,8,["fotoClick"])])),_:1},8,["modelValue","maximized"])])}const g={props:["message"],data(){return{watch:!1,fotoClick:{},maximized:!1}},components:{fotoCanvas:a(7808).Z},methods:{foto(e){this.fotoClick.img=e}}};var m=a(4027),p=a(5926),f=a(7518),w=a.n(f);g.render=h;const b=g;w()(g,"components",{QImg:m.Z,QDialog:p.Z})},7808:(e,t,a)=>{a.d(t,{Z:()=>u});var o=a(3673);const s={class:"img"};function i(e,t,a,i,n,l){const r=(0,o.up)("q-img"),c=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)("div",s,[(0,o.wy)((0,o.Wm)(r,{src:a.fotoClick.img},null,8,["src"]),[[c]])])}const n={props:["fotoClick"]};var l=a(4027),r=a(677),c=a(7518),d=a.n(c);n.render=i;const u=n;d()(n,"components",{QImg:l.Z}),d()(n,"directives",{ClosePopup:r.Z})},4574:(e,t,a)=>{a.d(t,{Z:()=>c});var o=a(3673);function s(e,t,a,s,i,n){const l=(0,o.up)("q-img");return(0,o.wg)(),(0,o.j4)(l,{src:a.fotoClick.img},null,8,["src"])}const i={props:["fotoClick"]};var n=a(4027),l=a(7518),r=a.n(l);i.render=s;const c=i;r()(i,"components",{QImg:n.Z})},3762:(e,t,a)=>{a.r(t),a.d(t,{default:()=>I});a(71);var o=a(3673),s=a(2323),i=a(8880);const n={key:1},l=(0,o._)("img",{id:"preview"},null,-1),r={key:2},c=(0,o._)("img",{id:"preview",hidden:""},null,-1);function d(e,t,a,d,u,h){const g=(0,o.up)("q-banner"),m=(0,o.up)("Chat"),p=(0,o.up)("q-chat-message"),f=(0,o.up)("q-linear-progress"),w=(0,o.up)("q-tab"),b=(0,o.up)("q-tabs"),y=(0,o.up)("q-btn"),v=(0,o.up)("q-input"),x=(0,o.up)("q-form"),k=(0,o.up)("q-toolbar"),_=(0,o.up)("q-footer"),C=(0,o.up)("searchGifs"),M=(0,o.up)("q-dialog"),q=(0,o.up)("minMenu"),U=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(U,{ref:"chatPage"},{default:(0,o.w5)((()=>[h.otherUser.online?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(g,{key:0,class:"bg-grey-4 text-center flex hidden"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(h.otherUser.name)+" no esta en línea. ",1)])),_:1})),(0,o._)("div",{class:(0,s.C_)([{invisible:!u.showMessages},"q-pa-md column col justify-end"])},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(h.limit,((e,t)=>((0,o.wg)(),(0,o.j4)(p,{key:t,sent:"me"==e.from,align:"me"==e.from?"right":"left","bg-color":"grey-1"},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{message:e},null,8,["message"])])),_:2},1032,["sent","align"])))),128))],2),(0,o.Wm)(_,{class:"bg-white",style:{"max-width":"475px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(k,{class:"text-weight-bold",style:{padding:".8em"}},{default:(0,o.w5)((()=>[h.loadArch?((0,o.wg)(),(0,o.j4)(f,{key:0,class:"tabs",stripe:"",size:"17px",value:h.loadArch/100},null,8,["value"])):(0,o.kq)("",!0),u.tab?((0,o.wg)(),(0,o.j4)(b,{key:1,class:"tabs"},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{class:"text-blue",style:{padding:".2em"},icon:"photo_camera",onClick:t[0]||(t[0]=e=>h.galeria(2))}),(0,o.Wm)(w,{class:"text-orange-8",style:{padding:".2em"},icon:"photo",onClick:t[1]||(t[1]=e=>h.galeria(1))}),(0,o.Wm)(w,{class:"text-grey-8",style:{padding:".2em"},icon:"attachment",onClick:t[2]||(t[2]=e=>h.galeria(4))}),(0,o.Wm)(w,{class:"text-black",style:{padding:".2em"},icon:"gif",onClick:t[3]||(t[3]=e=>h.galeria(5))}),(0,o.Wm)(w,{class:"text-grey-8",style:{padding:".2em"},icon:"close",onClick:t[4]||(t[4]=e=>u.tab=!1)})])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(x,{class:"full-width",id:"myform",onSubmit:t[8]||(t[8]=e=>h.SendChat("text"))},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{modelValue:u.newMessage,"onUpdate:modelValue":t[6]||(t[6]=e=>u.newMessage=e),ref:"newMessage",id:"message","bg-color":"white",borderless:"",color:"black",placeholder:"Escribe tu mensaje aquí....",onKeyup:t[7]||(t[7]=(0,i.D2)((e=>h.SendChat("text")),["enter"])),class:"chat",autogrow:"",dense:""},{default:(0,o.w5)((()=>[(0,o.Wm)(y,{disabled:h.loadArch,round:"",dense:"",flat:"",onClick:t[5]||(t[5]=e=>u.tab=!u.tab),class:"text-black",icon:"camera"},null,8,["disabled"]),(0,o.Wm)(y,{round:"",dense:"",flat:"",type:"submit",class:"text-primary",icon:"send"})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,o.Wm)(M,{modelValue:u.dialog_gifs,"onUpdate:modelValue":t[9]||(t[9]=e=>u.dialog_gifs=e),position:"bottom"},{default:(0,o.w5)((()=>[(0,o.Wm)(C)])),_:1},8,["modelValue"]),(0,o.Wm)(M,{modelValue:u.show_minMenu,"onUpdate:modelValue":t[10]||(t[10]=e=>u.show_minMenu=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(q)])),_:1},8,["modelValue"]),(0,o._)("input",{class:"hidden",filled:"",hint:"Native file",id:"subir",onChange:t[11]||(t[11]=(...e)=>h.changeFoto&&h.changeFoto(...e)),type:"file",accept:"image/*"},null,32),(0,o._)("input",{hidden:"",type:"file",id:"subirCamCordova",name:"file",onChange:t[12]||(t[12]=(...e)=>h.changeFoto&&h.changeFoto(...e)),accept:"image/*;",capture:"camera"},null,32),(0,o._)("input",{class:"hidden",filled:"",hint:"Native file",id:"subirCamCapacitor",onChange:t[13]||(t[13]=(...e)=>h.changeFoto&&h.changeFoto(...e)),type:"file",accept:"image/*",capture:"camera"},null,32),(0,o._)("input",{id:"subirArch",type:"file",onChange:t[14]||(t[14]=(...e)=>h.mandarArchivo&&h.mandarArchivo(...e)),style:{display:"none"}},null,32),1==this.$store.state.store.loads?((0,o.wg)(),(0,o.iD)("div",n,[(0,o._)("input",{id:"change",onClick:t[15]||(t[15]=(...e)=>h.onUpload&&h.onUpload(...e)),type:"text"}),l,(0,o.Wm)(y,{to:"/camara",label:"camara"}),(0,o.Wm)(y,{to:"/video",label:"video"})])):((0,o.wg)(),(0,o.iD)("div",r,[(0,o._)("input",{id:"change",onClick:t[16]||(t[16]=(...e)=>h.onUpload&&h.onUpload(...e)),type:"text",hidden:""}),c]))])),_:1},512)}a(7070),a(7965),a(6016);var u=a(3617),h=a(1082),g=a(141);let m="asd";const p={hora(){let e=h.ZP.formatDate(new Date,"HH:mm DD/MM");return e},leerTxt(){let e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=function(){4==e.readyState&&200==e.status&&alert(e.responseText)},e.open("GET","doc.json",!0),e.send()},scrollV(e,t){let a=Math.floor(e/t+e/500);return a},async resizeTools(e,t){return m=await g.Z.resize(e,{width:t,height:t},(async function(e,t){let a=await window.URL.createObjectURL(e);preview.src=a})),console.log(m),m}},f=p,w={style:{display:"flex","flex-wrap":"wrap"}},b=["onClick"],y=["src"];function v(e,t,a,n,l,r){const c=(0,o.up)("q-btn"),d=(0,o.up)("q-input"),u=(0,o.up)("q-form"),h=(0,o.up)("q-list"),g=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(h,{class:"bg-white text-center",style:{padding:"5px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{class:"full-width",onSubmit:r.searchGif},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{autofocus:"",type:"text",label:"Buscar gif",modelValue:l.gif,"onUpdate:modelValue":t[0]||(t[0]=e=>l.gif=e),onKeyup:(0,i.D2)(e.submit,["enter"]),style:{padding:"0em .8em"}},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{id:"btn",flat:"",type:"submit",class:"text-primary",icon:"search"})])),_:1},8,["modelValue","onKeyup"])])),_:1},8,["onSubmit"]),(0,o._)("div",w,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(l.urlGif,((e,t)=>((0,o.wg)(),(0,o.j4)(h,{key:t,style:{margin:"auto"}},{default:(0,o.w5)((()=>[(0,o.wy)((0,o._)("div",{onClick:t=>r.ongif(e.embed_url)},[(0,o._)("iframe",{src:e.embed_url,frameborder:"0",style:(0,s.j5)([{"pointer-events":"none"},r.width])},null,12,y)],8,b),[[g]])])),_:2},1024)))),128))])])),_:1})}var x=a(52),k=a.n(x);const _={data(){return{urlGif:"",gif:"",cant_gif:10}},computed:{width(){let e=this.$q.screen.width;return{width:.47*e+"px"}}},methods:{...(0,u.nv)("store",["SendMessage","RecibeMessage"]),searchGif(){k().get("https://api.giphy.com/v1/gifs/search?q="+this.gif+"&api_key=dIJrma20pSU6ymMwWnDbiaT7NFHeAGVa&limit="+this.cant_gif).then((async e=>{this.urlGif=await e.data.data}))},ongif(e){let t=f.hora();this.SendMessage({tipo:"gif",text:e,textweb:e,hora:t}),this.RecibeMessage({tipo:"gif",text:e,textweb:e,hora:t}),this.gif=""}}};var C=a(7011),M=a(5269),q=a(6805),U=a(2165),Z=a(677),T=a(7518),W=a.n(T);_.render=v;const A=_;W()(_,"components",{QList:C.Z,QForm:M.Z,QInput:q.Z,QBtn:U.Z}),W()(_,"directives",{ClosePopup:Z.Z});const D={data(){return{load:!1,dialog_gifs:!1,tab:!1,newMessage:"",show_minMenu:!1,showMessages:!1,fotolocal:"",calidad:700,cant_limit:0}},components:{minMenu:a(4574).Z,Chat:a(9390).Z,searchGifs:A},computed:{...(0,u.rn)("store",["userDetails","otherId"]),...(0,u.Se)("store",["messages"]),otherUser(){return this.$store.state.store.amigos[this.otherId]},loadArch(){return this.$store.state.store.loadArch},limit(){try{let e=Object.values(this.messages[this.otherId]).reverse(),t=[];return Object.values(e).slice(0,this.cant_limit).forEach((e=>{const{...a}=e;a.text="text"===a.tipo?atob(a.text):a.text,t.push(a)})),t.reverse()}catch{return{0:{tipo:"text",text:"Escribe tu 1er mensaje"}}}}},destroyed(){this.StopGettingMessages(),window.scrollTo(0,0)},watch:{messages:function(e){Object.keys(e).length&&this.scrollToBottom()}},mounted(){this.scrollToBottom(),setTimeout((()=>{this.showMessages=!0}),30);const e=this.$q.screen.height;this.cant_limit=e<642?10:e<851?15:20;const t=document.scrollingElement||document.body;let a=t.scrollHeight;window.onscroll=()=>{const e=t.scrollHeight;0>=window.scrollY-200&&e!=a&&(window.scroll(0,e-a),this.cant_limit+=10,a=e)}},methods:{...(0,u.nv)("store",["StopGettingMessages","SendMessage","RecibeMessage","subirArchivo","sendPhoto"]),scrollToBottom(){let e=this.$refs.chatPage.$el;setTimeout((()=>{window.scrollTo(0,e.scrollHeight)}),0)},noti(){this.$q.notify({position:"top",message:this.otherUser.name+"Te mando un mensaje",color:"green"})},SendChat(e){let t,a=f.hora(),o="";2==change.value?(1==this.$store.state.store.loads&&(alert("222"),alert(this.newMessage),alert(this.fotolocal)),t=this.fotolocal,o=this.newMessage):t=btoa(this.newMessage);let s={tipo:e,text:t,textweb:o,hora:a};this.SendMessage(s),this.RecibeMessage(s),this.clearMessage()},clearMessage(){change.value=1,this.newMessage=""},galeria(e){this.tab=!1,1==e?subir.click():2==e?subirCamCapacitor.click():4==e?subirArch.click():5==e&&(this.dialog_gifs=!0)},resizeTools(e,t){g.Z.resize(e,{width:t,height:t},(function(e,t){preview.src=window.URL.createObjectURL(e),change.click()}))},changeFoto(e){this.resizeTools(e.target.files[0],this.calidad)},onUpload(){this.load=!0;let e=f.hora(),t="FotosSend/"+this.userDetails.email+"/"+this.otherUser.name+"/"+e;const a=a=>{var o=function(e,t){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.addEventListener("load",(function(){t(a.response)})),a.send()};o(a,(a=>{let o={file:a,ruta:t,hora:e,tipo:"foto"};2==change.value&&(o.fotolocal=1),this.sendPhoto(o).then(this.load=!1)}))};a(preview.src)},captureImage(){function e(e){preview.src=e,change.click()}function t(e){}change.value=2,navigator.camera.getPicture(e,t,{quality:100,destinationType:Camera.DestinationType.FILE_URI,targetHeight:this.calidad,targetWidth:this.calidad})},mandarArchivo(e){this.load=!0;let t=f.hora(),a=e.target.files[0].name,o="Archivos/"+this.userDetails.email+"/"+this.otherUser.name+"/"+a;this.subirArchivo({file:e.target.files[0],ruta:o,name:a,hora:t,tipo:"url"}),this.clearMessage()}}};var j=a(4379),Q=a(5607),B=a(629),L=a(1762),R=a(9570),S=a(1598),z=a(2496),V=a(3269),H=a(5926);D.render=d;const I=D;W()(D,"components",{QPage:j.Z,QBanner:Q.Z,QChatMessage:B.Z,QFooter:L.Z,QToolbar:R.Z,QLinearProgress:S.Z,QTabs:z.Z,QTab:V.Z,QForm:M.Z,QInput:q.Z,QBtn:U.Z,QDialog:H.Z})}}]);