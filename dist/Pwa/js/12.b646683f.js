"use strict";(self["webpackChunknaxchatappv3"]=self["webpackChunknaxchatappv3"]||[]).push([[12],{141:(e,t,a)=>{a.d(t,{Z:()=>r});a(979),a(6105),a(2396),a(6101),a(71),a(7965),a(6016);let i="undefined"!==typeof Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),o=i&&"undefined"!==typeof Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),s="undefined"!==typeof HTMLCanvasElement&&HTMLCanvasElement.prototype.toBlob,n=s||"undefined"!==typeof Uint8Array&&"undefined"!==typeof ArrayBuffer&&"undefined"!==typeof atob,l="undefined"!==typeof FileReader||"undefined"!==typeof URL;class r{static resize(e,t,a){"function"===typeof t&&(a=t,t={width:640,height:480});t.width,t.height;if(!r.isSupported()||!e.type.match(/image.*/))return a(e,!1),!1;if(e.type.match(/image\/gif/))return a(e,!1),!1;let i=document.createElement("img");return i.onload=o=>{let n=i.width,l=i.height,c=!1;if(n>=l&&n>t.width?(l*=t.width/n,n=t.width,c=!0):l>t.height&&(n*=t.height/l,l=t.height,c=!0),!c)return void a(e,!1);let d=document.createElement("canvas");d.width=n,d.height=l;let u=d.getContext("2d");if(u.drawImage(i,0,0,n,l),s)d.toBlob((e=>{a(e,!0)}),e.type);else{let t=r._toBlob(d,e.type);a(t,!0)}},r._loadImage(i,e),!0}static _toBlob(e,t){let a,s=e.toDataURL(t),n=s.split(",");a=n[0].indexOf("base64")>=0?atob(n[1]):decodeURIComponent(n[1]);let l=new ArrayBuffer(a.length),r=new Uint8Array(l);for(let i=0;i<a.length;i+=1)r[i]=a.charCodeAt(i);let c=n[0].split(":")[1].split(";")[0],d=null;if(i)d=new Blob([o?r:l],{type:c});else{let e=new BlobBuilder;e.append(l),d=e.getBlob(c)}return d}static _loadImage(e,t,a){if("undefined"===typeof URL){let i=new FileReader;i.onload=function(t){e.src=t.target.result,a&&a()},i.readAsDataURL(t)}else e.src=URL.createObjectURL(t),a&&a()}static isSupported(){return"undefined"!==typeof HTMLCanvasElement&&n&&l}}},3657:(e,t,a)=>{a.d(t,{Z:()=>w});var i=a(3673),o=a(2323);const s={class:"chats"},n={key:0},l=["href"],r={key:3},c=["src"],d=(0,i._)("br",null,null,-1);function u(e,t,a,u,h,g){const m=(0,i.up)("q-img"),p=(0,i.up)("fotoCanvas"),f=(0,i.up)("q-dialog");return(0,i.wg)(),(0,i.iD)("span",s,["text"===a.message.tipo?((0,i.wg)(),(0,i.iD)("span",n,(0,o.zw)(a.message.text),1)):"foto"===a.message.tipo?((0,i.wg)(),(0,i.j4)(m,{key:1,style:{width:"180px",height:"180px"},src:a.message.text,onClick:t[0]||(t[0]=e=>(g.foto(a.message.text),h.watch=!0)),loading:"lazy"},null,8,["src"])):"url"===a.message.tipo?((0,i.wg)(),(0,i.iD)("a",{key:2,href:a.message.text,target:"_blank",style:{"text-decoration":"none",color:"black",background:"white",width:"100%","border-radius":"25px","text-align":"center",display:"inline-block"}}," Archivo ",8,l)):"gif"===a.message.tipo?((0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("iframe",{frameborder:"0",style:{width:"180px",height:"180px","pointer-events":"none"},src:a.message.text,loading:"lazy"},null,8,c)])):(0,i.kq)("",!0),d,(0,i._)("span",null,(0,o.zw)(a.message.hora),1),(0,i.Wm)(f,{modelValue:h.watch,"onUpdate:modelValue":t[1]||(t[1]=e=>h.watch=e),maximized:h.maximized},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{fotoClick:h.fotoClick},null,8,["fotoClick"])])),_:1},8,["modelValue","maximized"])])}const h={props:["message"],data(){return{watch:!1,fotoClick:{},maximized:!1}},components:{fotoCanvas:a(7808).Z},methods:{foto(e){this.fotoClick.img=e}}};var g=a(4027),m=a(5926),p=a(7518),f=a.n(p);h.render=u;const w=h;f()(h,"components",{QImg:g.Z,QDialog:m.Z})},7808:(e,t,a)=>{a.d(t,{Z:()=>u});var i=a(3673);const o={class:"img"};function s(e,t,a,s,n,l){const r=(0,i.up)("q-img"),c=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i.wy)((0,i.Wm)(r,{src:a.fotoClick.img},null,8,["src"]),[[c]])])}const n={props:["fotoClick"]};var l=a(4027),r=a(677),c=a(7518),d=a.n(c);n.render=s;const u=n;d()(n,"components",{QImg:l.Z}),d()(n,"directives",{ClosePopup:r.Z})},4574:(e,t,a)=>{a.d(t,{Z:()=>c});var i=a(3673);function o(e,t,a,o,s,n){const l=(0,i.up)("q-img");return(0,i.wg)(),(0,i.j4)(l,{src:a.fotoClick.img},null,8,["src"])}const s={props:["fotoClick"]};var n=a(4027),l=a(7518),r=a.n(l);s.render=o;const c=s;r()(s,"components",{QImg:n.Z})},8012:(e,t,a)=>{a.r(t),a.d(t,{default:()=>F});a(71);var i=a(3673),o=a(2323),s=a(8880);const n={key:0,class:"bg-white text-grey",style:{"text-align":"center"}},l={key:1},r=(0,i._)("img",{id:"preview"},null,-1),c={key:2},d=(0,i._)("img",{id:"preview",hidden:""},null,-1);function u(e,t,a,u,h,g){const m=(0,i.up)("q-banner"),p=(0,i.up)("Chat"),f=(0,i.up)("q-chat-message"),w=(0,i.up)("q-tab"),y=(0,i.up)("q-tabs"),b=(0,i.up)("q-spinner"),v=(0,i.up)("q-btn"),x=(0,i.up)("q-input"),k=(0,i.up)("q-form"),_=(0,i.up)("q-toolbar"),C=(0,i.up)("q-footer"),M=(0,i.up)("searchGifs"),q=(0,i.up)("q-dialog"),U=(0,i.up)("minMenu"),Z=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(Z,{ref:"pageChat",class:"page-chat bg-grey-2"},{default:(0,i.w5)((()=>[g.otherUser.online?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(m,{key:0,class:"bg-grey-4 text-center flex hidden"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,o.zw)(g.otherUser.name)+" no esta en línea. ",1)])),_:1})),(0,i._)("div",{class:(0,o.C_)([{invisible:!h.showMessages},"q-pa-md column col justify-end"])},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(g.limit,((e,t)=>((0,i.wg)(),(0,i.j4)(f,{key:t,sent:"me"==e.from,align:"me"==e.from?"right":"left"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{message:e},null,8,["message"])])),_:2},1032,["sent","align"])))),128))],2),(0,i.Wm)(C,{class:"bg-white",style:{"max-width":"475px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{class:"text-weight-bold",style:{padding:".8em"}},{default:(0,i.w5)((()=>[h.tab?((0,i.wg)(),(0,i.j4)(y,{key:0,class:"tabs"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"text-blue",style:{padding:".2em"},icon:"photo_camera",onClick:t[0]||(t[0]=e=>g.galeria(2))}),(0,i.Wm)(w,{class:"text-orange-8",style:{padding:".2em"},icon:"photo",onClick:t[1]||(t[1]=e=>g.galeria(1))}),(0,i.Wm)(w,{class:"text-grey-8",style:{padding:".2em"},icon:"attachment",onClick:t[2]||(t[2]=e=>g.galeria(4))}),(0,i.Wm)(w,{class:"text-black",style:{padding:".2em"},icon:"gif",onClick:t[3]||(t[3]=e=>g.galeria(5))}),(0,i.Wm)(w,{class:"text-grey-8",style:{padding:".2em"},icon:"close",onClick:t[4]||(t[4]=e=>h.tab=!1)})])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(k,{class:"full-width",id:"myform",onSubmit:t[8]||(t[8]=e=>g.SendChat("text"))},{default:(0,i.w5)((()=>[h.load?((0,i.wg)(),(0,i.iD)("div",n,[(0,i.Wm)(b,{color:"grey-6",size:"3em",thickness:2})])):(0,i.kq)("",!0),(0,i.Wm)(x,{modelValue:h.newMessage,"onUpdate:modelValue":t[6]||(t[6]=e=>h.newMessage=e),ref:"newMessage",id:"message","bg-color":"white",color:"black",placeholder:"Escribe tu mensaje aquí....",onKeyup:t[7]||(t[7]=(0,s.D2)((e=>g.SendChat("text")),["enter"])),class:"chat",autogrow:"",dense:""},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{round:"",dense:"",flat:"",onClick:t[5]||(t[5]=e=>h.tab=!h.tab),class:"text-accent",icon:"camera"}),(0,i.Wm)(v,{round:"",dense:"",flat:"",type:"submit",class:"text-primary",icon:"send"})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,i.Wm)(q,{modelValue:h.dialog_gifs,"onUpdate:modelValue":t[9]||(t[9]=e=>h.dialog_gifs=e),position:"bottom"},{default:(0,i.w5)((()=>[(0,i.Wm)(M)])),_:1},8,["modelValue"]),(0,i.Wm)(q,{modelValue:h.show_minMenu,"onUpdate:modelValue":t[10]||(t[10]=e=>h.show_minMenu=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(U)])),_:1},8,["modelValue"]),(0,i._)("input",{class:"hidden",filled:"",hint:"Native file",id:"subir",onChange:t[11]||(t[11]=(...e)=>g.changeFoto&&g.changeFoto(...e)),type:"file",accept:"image/*"},null,32),(0,i._)("input",{hidden:"",type:"file",id:"subirCamCordova",name:"file",onChange:t[12]||(t[12]=(...e)=>g.changeFoto&&g.changeFoto(...e)),accept:"image/*;",capture:"camera"},null,32),(0,i._)("input",{class:"hidden",filled:"",hint:"Native file",id:"subirCamCapacitor",onChange:t[13]||(t[13]=(...e)=>g.changeFoto&&g.changeFoto(...e)),type:"file",accept:"image/*",capture:"camera"},null,32),(0,i._)("input",{id:"subirArch",type:"file",onChange:t[14]||(t[14]=(...e)=>g.mandarArchivo&&g.mandarArchivo(...e)),style:{display:"none"}},null,32),1==this.$store.state.store.loads?((0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("input",{id:"change",onClick:t[15]||(t[15]=(...e)=>g.onUpload&&g.onUpload(...e)),type:"text"}),r,(0,i.Wm)(v,{to:"/camara",label:"camara"}),(0,i.Wm)(v,{to:"/video",label:"video"})])):((0,i.wg)(),(0,i.iD)("div",c,[(0,i._)("input",{id:"change",onClick:t[16]||(t[16]=(...e)=>g.onUpload&&g.onUpload(...e)),type:"text",hidden:""}),d]))])),_:1},512)}a(7070),a(7965),a(6016);var h=a(3617),g=a(1082),m=a(141);let p="asd";const f={hora(){let e=g.ZP.formatDate(new Date,"HH:mm DD/MM/YY");return e},leerTxt(){let e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");e.onreadystatechange=function(){4==e.readyState&&200==e.status&&alert(e.responseText)},e.open("GET","doc.json",!0),e.send()},scrollV(e,t){let a=Math.floor(e/t+e/500);return a},async resizeTools(e,t){return p=await m.Z.resize(e,{width:t,height:t},(async function(e,t){let a=await window.URL.createObjectURL(e);preview.src=a})),console.log(p),p}},w=f,y={style:{display:"flex","flex-wrap":"wrap"}},b=["onClick"],v=["src"];function x(e,t,a,n,l,r){const c=(0,i.up)("q-btn"),d=(0,i.up)("q-input"),u=(0,i.up)("q-form"),h=(0,i.up)("q-list"),g=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.j4)(h,{class:"bg-white text-center",style:{padding:"5px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{class:"full-width",onSubmit:r.searchGif},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{autofocus:"",type:"text",label:"Buscar gif",modelValue:l.gif,"onUpdate:modelValue":t[0]||(t[0]=e=>l.gif=e),onKeyup:(0,s.D2)(e.submit,["enter"]),style:{padding:"0em .8em"}},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{id:"btn",flat:"",type:"submit",class:"text-primary",icon:"search"})])),_:1},8,["modelValue","onKeyup"])])),_:1},8,["onSubmit"]),(0,i._)("div",y,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(l.urlGif,((e,t)=>((0,i.wg)(),(0,i.j4)(h,{key:t,style:{margin:"auto"}},{default:(0,i.w5)((()=>[(0,i.wy)((0,i._)("div",{onClick:t=>r.ongif(e.embed_url)},[(0,i._)("iframe",{src:e.embed_url,frameborder:"0",style:(0,o.j5)([{"pointer-events":"none"},r.width])},null,12,v)],8,b),[[g]])])),_:2},1024)))),128))])])),_:1})}var k=a(52),_=a.n(k);const C={data(){return{urlGif:"",gif:"",cant_gif:10}},computed:{width(){let e=this.$q.screen.width;return{width:.47*e+"px"}}},methods:{...(0,h.nv)("store",["SendMessage","RecibeMessage"]),searchGif(){_().get("https://api.giphy.com/v1/gifs/search?q="+this.gif+"&api_key=dIJrma20pSU6ymMwWnDbiaT7NFHeAGVa&limit="+this.cant_gif).then((async e=>{this.urlGif=await e.data.data}))},ongif(e){let t=w.hora();this.SendMessage({tipo:"gif",text:e,textweb:e,hora:t}),this.RecibeMessage({tipo:"gif",text:e,textweb:e,hora:t}),this.gif=""}}};var M=a(7011),q=a(5269),U=a(6805),Z=a(2165),W=a(677),T=a(7518),D=a.n(T);C.render=x;const Q=C;D()(C,"components",{QList:M.Z,QForm:q.Z,QInput:U.Z,QBtn:Z.Z}),D()(C,"directives",{ClosePopup:W.Z});const j={data(){return{load:!1,dialog_gifs:!1,tab:!1,newMessage:"",show_minMenu:!1,showMessages:!1,fotolocal:"",calidad:700,cant_limit:0}},components:{minMenu:a(4574).Z,Chat:a(3657).Z,searchGifs:Q},computed:{...(0,h.rn)("store",["userDetails","otherId"]),...(0,h.Se)("store",["messages"]),otherUser(){return this.$store.state.store.amigos[this.otherId]},limit(){try{let e=Object.values(this.messages[this.otherId]).reverse(),t=[];return Object.values(e).slice(0,this.cant_limit).forEach((e=>{const{...a}=e;a.text="text"===a.tipo?atob(a.text):a.text,t.push(a)})),t.reverse()}catch{return{0:{tipo:"text",text:"Escribe tu 1er mensaje"}}}}},destroyed(){this.StopGettingMessages()},watch:{messages:function(e){Object.keys(e).length&&this.scrollToBottom()}},mounted(){this.scrollToBottom(),setTimeout((()=>{this.showMessages=!0}),0);let e=this.$q.screen.height;this.cant_limit=e<642?10:e<851?15:20;let t=document.scrollingElement||document.body,a=t.scrollHeight;window.onscroll=()=>{let e=t.scrollHeight;0>=window.scrollY-200&&e!=a&&(window.scroll(0,e-a),this.cant_limit+=10,a=e)}},methods:{...(0,h.nv)("store",["StopGettingMessages","SendMessage","RecibeMessage","subirArchivo","sendPhoto"]),scrollToBottom(){let e=this.$refs.pageChat.$el;setTimeout((()=>{window.scrollTo(0,e.scrollHeight)}),0)},noti(){this.$q.notify({position:"top",message:this.otherUser.name+"Te mando un mensaje",color:"green"})},SendChat(e){let t,a=w.hora(),i="";2==change.value?(1==this.$store.state.store.loads&&(alert("222"),alert(this.newMessage),alert(this.fotolocal)),t=this.fotolocal,i=this.newMessage):t=btoa(this.newMessage);let o={tipo:e,text:t,textweb:i,hora:a};this.SendMessage(o),this.RecibeMessage(o),this.clearMessage()},clearMessage(){change.value=1,this.newMessage=""},galeria(e){this.tab=!1,1==e?subir.click():2==e?subirCamCapacitor.click():4==e?subirArch.click():5==e&&(this.dialog_gifs=!0)},resizeTools(e,t){m.Z.resize(e,{width:t,height:t},(function(e,t){preview.src=window.URL.createObjectURL(e),change.click()}))},changeFoto(e){this.resizeTools(e.target.files[0],this.calidad)},onUpload(){this.load=!0;let e=w.hora(),t="FotosSend/"+this.userDetails.email+"/"+this.otherUser.name+"/"+e;const a=a=>{var i=function(e,t){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.addEventListener("load",(function(){t(a.response)})),a.send()};i(a,(a=>{let i={file:a,ruta:t,hora:e,tipo:"foto"};2==change.value&&(i.fotolocal=1),this.sendPhoto(i).then(this.load=!1)}))};a(preview.src)},captureImage(){function e(e){preview.src=e,change.click()}function t(e){}change.value=2,navigator.camera.getPicture(e,t,{quality:100,destinationType:Camera.DestinationType.FILE_URI,targetHeight:this.calidad,targetWidth:this.calidad})},mandarArchivo(e){this.load=!0;let t=w.hora(),a=e.target.files[0].name,i="Archivos/"+this.userDetails.email+"/"+this.otherUser.name+"/"+a;this.subirArchivo({file:e.target.files[0],ruta:i,name:a,hora:t,tipo:"url"}).then(this.load=!1),this.clearMessage()}}};var B=a(4379),R=a(5607),L=a(629),A=a(1762),S=a(9570),z=a(2496),V=a(3269),H=a(9754),I=a(5926);j.render=u;const F=j;D()(j,"components",{QPage:B.Z,QBanner:R.Z,QChatMessage:L.Z,QFooter:A.Z,QToolbar:S.Z,QTabs:z.Z,QTab:V.Z,QForm:q.Z,QSpinner:H.Z,QInput:U.Z,QBtn:Z.Z,QDialog:I.Z})}}]);